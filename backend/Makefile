.PHONY: help build up down restart logs migrate makemigrations shell createsuperuser test clean ps

# VariÃ¡veis
DOCKER_COMPOSE = docker-compose
BACKEND_CONTAINER = petkeep_backend
DB_CONTAINER = petkeep_db

help:
	@echo "Comandos disponÃ­veis para o PetKeep Backend:"
	@echo ""
	@echo "  make build          - ConstrÃ³i as imagens Docker"
	@echo "  make up             - Inicia os containers em background"
	@echo "  make down           - Para e remove os containers"
	@echo "  make restart        - Reinicia os containers"
	@echo "  make logs           - Exibe os logs do backend"
	@echo "  make logs-db        - Exibe os logs do banco de dados"
	@echo "  make ps             - Lista os containers em execuÃ§Ã£o"
	@echo ""
	@echo "  make migrate        - Executa as migraÃ§Ãµes do Django"
	@echo "  make makemigrations - Cria novas migraÃ§Ãµes"
	@echo "  make shell          - Abre o shell do Django"
	@echo "  make createsuperuser - Cria um superusuÃ¡rio"
	@echo ""
	@echo "  make test           - Executa os testes"
	@echo "  make clean          - Remove containers, volumes e imagens"
	@echo "  make collectstatic  - Coleta arquivos estÃ¡ticos"

build:
	@echo "ğŸ—ï¸  Construindo as imagens Docker..."
	$(DOCKER_COMPOSE) build

up:
	@echo "ğŸš€ Iniciando os containers..."
	$(DOCKER_COMPOSE) up
	@echo "âœ… Containers iniciados! Backend disponÃ­vel em http://localhost:8080"

down:
	@echo "ğŸ›‘ Parando os containers..."
	$(DOCKER_COMPOSE) down

restart: down up

logs:
	@echo "ğŸ“‹ Logs do backend:"
	$(DOCKER_COMPOSE) logs -f backend

logs-db:
	@echo "ğŸ“‹ Logs do banco de dados:"
	$(DOCKER_COMPOSE) logs -f db

ps:
	@echo "ğŸ“Š Status dos containers:"
	$(DOCKER_COMPOSE) ps

migrate:
	@echo "ğŸ”„ Executando migraÃ§Ãµes..."
	$(DOCKER_COMPOSE) exec backend python manage.py migrate

makemigrations:
	@echo "ğŸ“ Criando migraÃ§Ãµes..."
	$(DOCKER_COMPOSE) exec backend python manage.py makemigrations

shell:
	@echo "ğŸš Abrindo Django shell..."
	$(DOCKER_COMPOSE) exec backend python manage.py shell

createsuperuser:
	@echo "ğŸ‘¤ Criando superusuÃ¡rio..."
	$(DOCKER_COMPOSE) exec backend python manage.py createsuperuser

collectstatic:
	@echo "ğŸ“¦ Coletando arquivos estÃ¡ticos..."
	$(DOCKER_COMPOSE) exec backend python manage.py collectstatic --noinput

test:
	@echo "ğŸ§ª Executando testes..."
	$(DOCKER_COMPOSE) exec backend pytest

clean:
	@echo "ğŸ§¹ Limpando containers, volumes e imagens..."
	$(DOCKER_COMPOSE) down -v --rmi all
	@echo "âœ… Limpeza concluÃ­da!"

# Comandos adicionais Ãºteis
exec:
	@echo "ğŸ’» Abrindo bash no container backend..."
	$(DOCKER_COMPOSE) exec backend bash

exec-db:
	@echo "ğŸ’» Abrindo psql no container db..."
	$(DOCKER_COMPOSE) exec db psql -U petkeep_user -d petkeep_db

requirements:
	@echo "ğŸ“¦ Instalando dependÃªncias..."
	$(DOCKER_COMPOSE) exec backend pip install -r requirements.txt

rebuild: down build up
	@echo "âœ… Rebuild completo!"
